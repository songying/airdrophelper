# AirdropHelper 测试指南

## 修复验证清单

### ✅ 已修复的问题

#### 1. 同一地图进度条重复问题
**问题描述**: 之前同一地图可能出现多个进度条
**修复方案**: 
- 现在同一地图只显示一个进度条
- 新触发会更新现有的进度条而不是创建新的
- 保持18分钟的计时时长

**测试步骤**:
1. 在同一地图使用 `/adh test` 触发测试空投
2. 再次使用 `/adh test` 
3. 验证只有一个进度条，且时间被重置为新的18分钟

#### 2. 战争宝箱误触发问题
**问题描述**: 战争宝箱检测器误报，没有实际宝箱却触发了进度条
**修复方案**:
- 暂时完全禁用空投检测器 (`AirdropDetector`)
- 只保留NPC对话触发机制
- 添加手动控制命令供将来使用

**测试步骤**:
1. 确认插件启动时显示 "空投检测器已初始化 (暂时禁用)"
2. 验证不再有误触发的战争宝箱进度条
3. 确认NPC触发机制仍然正常工作

## 测试命令

### 基础功能测试
```bash
/adh help              # 查看所有可用命令
/adh test              # 测试空投触发（创建1分钟测试计时器）
/adh show              # 显示计时器窗口
/adh hide              # 隐藏计时器窗口
```

### 界面测试
```bash
/adh lock              # 锁定窗口位置
/adh unlock            # 解锁窗口位置
```

### 调试测试
```bash
/adh debug             # 开启调试模式（查看详细日志）
/adh detector          # 查看空投检测器状态（应显示"禁用"）
/adh detector on       # 手动启用检测器（谨慎使用）
/adh detector off      # 手动禁用检测器
```

## 预期行为

### 正常情况
1. **插件启动**: 
   - 显示版本信息
   - 显示 "空投检测器已初始化 (暂时禁用)"
   - 不应该有任何错误

2. **NPC触发**: 
   - 当配置的NPC说出关键词时触发空投
   - 创建18分钟倒计时进度条
   - 发送通知到适当的聊天频道

3. **地图切换**:
   - 同一地图多次触发只显示一个进度条
   - 不同地图可以有各自的进度条
   - 切换地图时旧地图的计时器继续运行

4. **进度条颜色变化**:
   - 绿色: 初始状态
   - 黄色: 剩余时间 < 8分钟  
   - 红色: 剩余时间 < 2分钟
   - 闪烁红色: 过期后继续负数计时

### 不应该发生的情况
1. ❌ 同一地图出现多个进度条
2. ❌ 没有NPC对话却自动触发空投
3. ❌ 插件加载时出现Lua错误
4. ❌ 战争宝箱误触发

## 测试场景

### 场景1: 基础功能测试
1. 重新加载UI: `/reload`
2. 查看插件是否正常加载
3. 使用 `/adh test` 创建测试计时器
4. 验证进度条显示和颜色变化
5. 验证计时结束后的提醒

### 场景2: 同地图重复触发测试  
1. 使用 `/adh test` 创建第一个计时器
2. 立即再次使用 `/adh test`
3. 确认只有一个进度条，时间重置为新的计时

### 场景3: 多地图测试
1. 在地图A使用 `/adh test`
2. 移动到地图B使用 `/adh test`  
3. 确认两个地图各有一个计时器
4. 返回地图A，再次触发，确认A的计时器被更新

### 场景4: NPC触发测试（需要实际游戏环境）
1. 开启调试模式: `/adh debug`
2. 寻找配置的NPC（魯夫厄斯、瑪莉希亞）
3. 等待NPC说出关键词
4. 验证触发空投和通知

## 故障排除

### 如果进度条不显示
1. 检查 `/adh show` 确保界面可见
2. 使用 `/adh unlock` 解锁后拖拽窗口
3. 尝试 `/adh reset` 重置设置

### 如果出现多个进度条
1. 这是bug，需要报告
2. 临时解决: `/adh reset` 清理所有计时器

### 如果仍有误触发
1. 确认检测器状态: `/adh detector`
2. 如果显示"启用"，使用 `/adh detector off` 禁用
3. 检查调试日志确认触发源

## 当前限制

1. **只支持NPC触发**: 战争宝箱检测暂时禁用
2. **地图识别**: 基于游戏内地图名称，可能因本地化而不同
3. **NPC名称**: 目前只配置了两个NPC，可能需要根据实际游戏添加更多

## 未来改进计划

1. **智能宝箱检测**: 改进算法减少误报
2. **更多NPC支持**: 添加更多空投相关NPC
3. **位置记录**: 记录空投触发的具体坐标
4. **统计功能**: 追踪空投成功率和时间分布

---

**测试版本**: v1.0.0  
**最后更新**: 2025-09-19  
**适用魔兽世界版本**: 11.2.x