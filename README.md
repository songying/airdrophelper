# AirdropHelper - 魔兽世界空投助手插件

## 项目概述
AirdropHelper 是一个专为魔兽世界 11.2 版本设计的空投箱子监控插件。该插件能够监控特定NPC的对话、检测空投箱子出现、发送智能通知并提供可视化的倒计时界面。

## 主要功能

### ⚔️ 战争模式依赖
- **仅在开启战争模式时工作**
- 关闭战争模式时自动隐藏界面并停止所有功能
- 实时检测战争模式变化，自动激活/停用

### 🎯 NPC对话监控
- 监听 `CHAT_MSG_MONSTER_SAY` 事件
- 预配置监控特定NPC（魯夫厄斯、瑪莉希亞等）
- 关键词匹配触发空投警报
- 支持自定义NPC和关键词

### 📢 智能通知系统
- **自动优先级选择**：
  1. 团队警报（如有权限）
  2. 团队频道（如在团队中）
  3. 小队频道（如在小队中）
  4. 普通说话（**包括单人时**）
- 通知格式：`空投箱子 [地图名称] [时间]`
- 防刷屏冷却机制
- 确保在任何情况下都能看到通知

### ⏱️ 可视化倒计时界面
- **无边框窗体**，4个标准图标宽度
- 最多显示10个进度条
- **动态颜色变化**：
  - 🟢 绿色：初始状态
  - 🟡 黄色：少于8分钟
  - 🔴 红色：少于2分钟
  - ⚡ 闪烁：过期后负数计时
- **计时时长**：
  - NPC触发：18分钟
  - ~~视觉检测：16分钟~~（暂时禁用）
- **交互功能**：
  - 右侧X按钮：手动关闭进度条
  - 同一地图只显示一个进度条（新触发更新旧的）

### 👁️ 空投箱子视觉检测
- ~~基于地图标记（Vignette）检测~~（**暂时禁用**）
- ~~参考HandyNotes插件逻辑~~
- **当前只使用NPC触发机制**，避免误报
- 可通过 `/adh detector on` 手动启用（不推荐）

### 🔄 玩家间信息同步
- 类似HandyNotes/Silver Dragon的同步机制
- **仅支持团队、小队频道同步**（不与公会同步，保护隐私）
- 自动验证发送者身份，确保同步安全性
- 自动去重，避免重复通知
- 版本兼容性检查

## 安装方法

1. 将插件文件夹放入魔兽世界插件目录：
   ```
   World of Warcraft\_retail_\Interface\AddOns\AirdropHelper\
   ```

2. 启动游戏，在插件管理界面启用 AirdropHelper

3. 使用 `/adh` 或 `/airdrophelper` 命令进行配置

## 使用命令

```
/adh help          - 显示帮助信息
/adh show          - 显示计时器窗口
/adh hide          - 隐藏计时器窗口
/adh lock          - 锁定窗口位置
/adh unlock        - 解锁窗口位置
/adh reset         - 重置所有设置
/adh debug         - 切换调试模式
/adh test          - 测试空投触发（需要战争模式）
/adh detector      - 查看/控制空投检测器
/adh status        - 查看插件状态
```

**⚠️ 重要提醒**: 插件仅在战争模式开启时工作

## 配置选项

### 基本设置
- 启用/禁用插件
- 调试模式开关
- UI界面锁定

### 通知设置
- 通知方式选择
- 声音提醒开关
- 自定义声音文件

### 同步设置
- 公会频道同步
- 团队频道同步
- 小队频道同步

### NPC监控设置
- 自定义NPC关键词
- 触发冷却时间
- 监控区域设置

## 文件结构

```
AirdropHelper/
├── AirdropHelper.toc           # 插件配置文件
├── AirdropHelper.lua           # 主插件文件
├── NPCMonitor.lua             # NPC监控模块
├── NotificationSystem.lua     # 通知系统
├── TimerUI.lua                # 计时器UI界面
├── AirdropDetector.lua        # 空投检测模块
├── SyncManager.lua            # 同步管理器
├── Core/
│   ├── Constants.lua          # 常量定义
│   ├── Config.lua             # 配置管理
│   └── Utils.lua              # 工具函数
├── design.md                  # 设计文档
└── README.md                  # 说明文档
```

## 技术特性

### 兼容性
- 支持魔兽世界 11.2 版本
- 使用最新WoW API
- 向后兼容性设计

### 性能优化
- 事件节流机制
- 智能冷却系统
- 内存使用优化
- 定期清理过期数据

### 错误处理
- 全面的错误捕获
- 优雅降级机制
- 调试信息输出
- 用户友好的错误提示

## 依赖关系

### 必需依赖
- 魔兽世界客户端 11.2+

### 可选依赖
- HandyNotes（用于增强空投检测）

## 开发说明

### 代码结构
- 模块化设计，便于维护
- 事件驱动架构
- 配置与逻辑分离
- 完整的错误处理

### 调试功能
- 启用调试模式：`/adh debug`
- 查看详细日志输出
- 测试功能：`/adh test`

### 自定义扩展
- 添加新的NPC监控
- 自定义通知方式
- 扩展同步功能
- 修改UI样式

## 常见问题

### Q: 插件不工作怎么办？
A: 
1. 检查插件是否正确安装
2. 确认插件已启用
3. 使用 `/adh debug` 开启调试模式
4. 查看聊天窗口的错误信息

### Q: 计时器显示不准确？
A: 
1. 确认系统时间正确
2. 检查网络延迟
3. 重新加载UI：`/reload`

### Q: 通知发送失败？
A: 
1. 检查聊天频道权限
2. 确认在正确的队伍/公会中
3. 检查插件通知设置

### Q: 如何自定义NPC关键词？
A: 
1. 编辑配置文件中的 `npcKeywords` 部分
2. 或使用游戏内命令添加（功能开发中）

## 更新日志

### v1.0.0 (2025-09-19)
- 🎉 初始版本发布
- ✅ 完整的NPC监控功能
- ✅ 智能通知系统
- ✅ 可视化计时器UI
- ✅ 空投检测功能
- ✅ 玩家间同步功能

## 作者信息

- **作者**: Alvin
- **版本**: 1.0.0
- **适配**: 魔兽世界 11.2

## 许可证

MIT License - 详见 LICENSE 文件

## 贡献指南

欢迎提交问题报告和功能建议！

1. Fork 这个项目
2. 创建功能分支
3. 提交您的更改
4. 发起 Pull Request

---

**注意**: 请确保您的魔兽世界客户端版本为 11.2 或更高版本以获得最佳兼容性。